make a plan to add a button on the memory editing and adding on the frontend that will decide if a certain memory is put into the system message or not. change how memories are stored. we need: Memory type, memory description, memory title and complete memory and the boolean if they are put into the system message or not, and memory ID.
also change how list_memories work, sending only title, description and type to the context. also add a new tool get_memory by their title or ID. the full memory should only go to the context if the get_memory is called. also add a memory type called Skill. naturally the add_memory tool should be changed to apply he new parameters. ensure the new system is correctly saved and retrieved from the database. you may create a temporary file to migrate the old memories to the new system.

 Memory System Refactoring Plan                                                                                                                                                                                                               
                                                                                                                                                                                                                                              
 Overview                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                              
 Refactor the memory system to support:                                                                                                                                                                                                       
 - Title, description, and type fields (replacing category)                                                                                                                                                                                   
 - Boolean flag to control system message injection                                                                                                                                                                                           
 - New "Skill" memory type                                                                                                                                                                                                                    
 - Optimized list_memories (summary only) and new get_memory tool                                                                                                                                                                             
 - Automatic migration from old format                                                                                                                                                                                                        
                                                                                                                                                                                                                                              
 Architecture Changes                                                                                                                                                                                                                         
                                                                                                                                                                                                                                              
 New Memory Structure                                                                                                                                                                                                                         
                                                                                                                                                                                                                                              
 {                                                                                                                                                                                                                                            
   id: string,                                                                                                                                                                                                                                
   title: string,              // NEW - required                                                                                                                                                                                              
   description: string,        // NEW - optional                                                                                                                                                                                              
   content: string,            // KEEP - full memory text                                                                                                                                                                                     
   type: string,               // RENAMED from category, add "skill"                                                                                                                                                                          
   includeInSystemMessage: boolean,  // NEW - default true                                                                                                                                                                                    
   createdAt: string,                                                                                                                                                                                                                         
   updatedAt: string,                                                                                                                                                                                                                         
   metadata: object                                                                                                                                                                                                                           
 }                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                              
 Key Decisions                                                                                                                                                                                                                                
                                                                                                                                                                                                                                              
 - Storage: Keep JSON file at /home/workspace/zo_chat_memories/memories.json (no SQLite migration)                                                                                                                                            
 - Content Field: Maintain as single source of truth for full memory text                                                                                                                                                                     
 - Default Behavior: All new memories default to includeInSystemMessage=true (maintains current behavior)                                                                                                                                     
 - get_memory Priority: ID lookup first, then exact title match, then case-insensitive                                                                                                                                                        
 - Migration: Auto-migrate on server startup, generate titles from first sentence/50 chars                                                                                                                                                    
                                                                                                                                                                                                                                              
 Implementation Steps                                                                                                                                                                                                                         
                                                                                                                                                                                                                                              
 Phase 1: Backend Core Changes                                                                                                                                                                                                                
                                                                                                                                                                                                                                              
 1. Create Migration Utility                                                                                                                                                                                                                  
                                                                                                                                                                                                                                              
 File: /backend/src/services/memoryMigration.js (new file)                                                                                                                                                                                    
                                                                                                                                                                                                                                              
 class MemoryMigration {                                                                                                                                                                                                                      
   // Generate title: first sentence or first 50 chars                                                                                                                                                                                        
   generateTitle(content)                                                                                                                                                                                                                     
                                                                                                                                                                                                                                              
   // Generate description: first 150 chars                                                                                                                                                                                                   
   generateDescription(content)                                                                                                                                                                                                               
                                                                                                                                                                                                                                              
   // Map old category to new type                                                                                                                                                                                                            
   mapCategoryToType(category)                                                                                                                                                                                                                
                                                                                                                                                                                                                                              
   // Determine includeInSystemMessage (default true)                                                                                                                                                                                         
   shouldIncludeInSystem(category)                                                                                                                                                                                                            
                                                                                                                                                                                                                                              
   // Migrate single memory                                                                                                                                                                                                                   
   migrateMemory(oldMemory)                                                                                                                                                                                                                   
                                                                                                                                                                                                                                              
   // Migrate all memories                                                                                                                                                                                                                    
   migrateMemoriesData(memoriesData)                                                                                                                                                                                                          
 }                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                              
 2. Update Memory Manager                                                                                                                                                                                                                     
                                                                                                                                                                                                                                              
 File: /backend/src/services/memoryManager.js                                                                                                                                                                                                 
                                                                                                                                                                                                                                              
 Changes:                                                                                                                                                                                                                                     
 - Import memoryMigration utility                                                                                                                                                                                                             
 - Update addMemory() signature: (title, description, content, type, includeInSystemMessage, metadata)                                                                                                                                        
 - Update getMemoriesAsText(): filter by includeInSystemMessage !== false                                                                                                                                                                     
 - Update updateMemory(): support title, description, type, includeInSystemMessage fields                                                                                                                                                     
 - Add migration check in initialize(): detect old format (has category field), run migration, save                                                                                                                                           
 - Update default system memory: add title/description, use type instead of category                                                                                                                                                          
                                                                                                                                                                                                                                              
 3. Update MCP Tool Definitions                                                                                                                                                                                                               
                                                                                                                                                                                                                                              
 File: /backend/src/index.js (lines 142-237)                                                                                                                                                                                                  
                                                                                                                                                                                                                                              
 list_memories tool:                                                                                                                                                                                                                          
 - Update description: "List all memories with summary (id, title, description, type only)"                                                                                                                                                   
 - Handler: return memories.map(m => id, title, description, type, includeInSystemMessage) - NO content field                                                                                                                                 
                                                                                                                                                                                                                                              
 get_memory tool (NEW):                                                                                                                                                                                                                       
 - Parameters: id (optional), title (optional)                                                                                                                                                                                                
 - Priority: ID lookup → exact title → case-insensitive title                                                                                                                                                                                 
 - Handle duplicate titles: return error with list of matching IDs                                                                                                                                                                            
 - Return: full memory including content                                                                                                                                                                                                      
                                                                                                                                                                                                                                              
 add_memory tool:                                                                                                                                                                                                                             
 - Update parameters: title (required), description (optional), content (required), type (enum with "skill"), includeInSystemMessage (boolean, default true)                                                                                  
 - Update handler: pass all params to memoryManager.addMemory()                                                                                                                                                                               
                                                                                                                                                                                                                                              
 4. Update API Routes                                                                                                                                                                                                                         
                                                                                                                                                                                                                                              
 File: /backend/src/routes/chat.js (lines 910-1020)                                                                                                                                                                                           
                                                                                                                                                                                                                                              
 POST /api/chat/memories:                                                                                                                                                                                                                     
 - Extract: title, description, content, type, includeInSystemMessage from req.body                                                                                                                                                           
 - Validate: title and content required                                                                                                                                                                                                       
 - Call: memoryManager.addMemory() with all params                                                                                                                                                                                            
                                                                                                                                                                                                                                              
 PUT /api/chat/memories/:id:                                                                                                                                                                                                                  
 - Extract: title, description, content, type, includeInSystemMessage from req.body                                                                                                                                                           
 - Build updates object with provided fields                                                                                                                                                                                                  
 - Call: memoryManager.updateMemory() with updates                                                                                                                                                                                            
                                                                                                                                                                                                                                              
 Phase 2: Frontend Changes                                                                                                                                                                                                                    
                                                                                                                                                                                                                                              
 5. Update MemoriesTab Component                                                                                                                                                                                                              
                                                                                                                                                                                                                                              
 File: /frontend/src/components/MemoriesTab.jsx                                                                                                                                                                                               
                                                                                                                                                                                                                                              
 Changes:                                                                                                                                                                                                                                     
 - Update CATEGORIES → TYPES constant: add "skill" type                                                                                                                                                                                       
 - Update state for newMemory/editForm: add title, description, includeInSystemMessage fields                                                                                                                                                 
 - Update handleAddMemory: validate title required, pass all new fields                                                                                                                                                                       
 - Update handleSave: pass title, description, type, includeInSystemMessage in API calls                                                                                                                                                      
 - Add JSX for title input field (required, autofocus)                                                                                                                                                                                        
 - Add JSX for description input field (optional)                                                                                                                                                                                             
 - Add JSX for includeInSystemMessage toggle checkbox                                                                                                                                                                                         
 - Update memory display: show title (bold), description (italic), content                                                                                                                                                                    
 - Update edit form: include all new fields                                                                                                                                                                                                   
                                                                                                                                                                                                                                              
 6. Update CSS Styling                                                                                                                                                                                                                        
                                                                                                                                                                                                                                              
 File: /frontend/src/components/MemoriesTab.css                                                                                                                                                                                               
                                                                                                                                                                                                                                              
 Add styles:                                                                                                                                                                                                                                  
 - .memory-title-input, .memory-description-input: input field styles                                                                                                                                                                         
 - .memory-title: bold display text                                                                                                                                                                                                           
 - .memory-description: italic, secondary color                                                                                                                                                                                               
 - .memory-toggle: checkbox + label flex layout                                                                                                                                                                                               
 - .memory-item.type-skill: cyan border for skill type                                                                                                                                                                                        
                                                                                                                                                                                                                                              
 7. Update API Service                                                                                                                                                                                                                        
                                                                                                                                                                                                                                              
 File: /frontend/src/services/api.js (lines 166-206)                                                                                                                                                                                          
                                                                                                                                                                                                                                              
 Update methods:                                                                                                                                                                                                                              
 - addMemory(title, description, content, type, includeInSystemMessage, metadata): pass all params in POST body                                                                                                                               
 - updateMemory(id, updates): support title, description, type, includeInSystemMessage in updates object                                                                                                                                      
                                                                                                                                                                                                                                              
 Phase 3: Testing & Verification                                                                                                                                                                                                              
                                                                                                                                                                                                                                              
 Manual Testing Checklist                                                                                                                                                                                                                     
                                                                                                                                                                                                                                              
 1. Migration:                                                                                                                                                                                                                                
   - Backup existing memories.json                                                                                                                                                                                                            
   - Start server, check logs for migration                                                                                                                                                                                                   
   - Verify memories.json has title/description/type fields                                                                                                                                                                                   
   - Verify no data loss                                                                                                                                                                                                                      
 2. Frontend UI:                                                                                                                                                                                                                              
   - Add new memory with title, description, content, type=skill, toggle on/off                                                                                                                                                               
   - Edit existing memory, change all fields                                                                                                                                                                                                  
   - Save and reload, verify persistence                                                                                                                                                                                                      
   - Test type filter dropdown                                                                                                                                                                                                                
 3. System Message Injection:                                                                                                                                                                                                                 
   - Create memory with includeInSystemMessage=false                                                                                                                                                                                          
   - Start chat, verify memory NOT in system message (check logs)                                                                                                                                                                             
   - Toggle to true, verify memory IS in system message                                                                                                                                                                                       
 4. MCP Tools:                                                                                                                                                                                                                                
   - Call list_memories: verify no content field, only title/description/type                                                                                                                                                                 
   - Call get_memory with ID: verify full content returned                                                                                                                                                                                    
   - Call get_memory with title: verify lookup works                                                                                                                                                                                          
   - Call add_memory with new structure: verify success                                                                                                                                                                                       
                                                                                                                                                                                                                                              
 End-to-End Test Flow                                                                                                                                                                                                                         
                                                                                                                                                                                                                                              
 1. Start fresh server with old-format memories.json                                                                                                                                                                                          
 2. Server auto-migrates on startup                                                                                                                                                                                                           
 3. Open frontend Memories tab                                                                                                                                                                                                                
 4. Add new memory: title="Test Skill", type="skill", includeInSystemMessage=true                                                                                                                                                             
 5. Save to cloud                                                                                                                                                                                                                             
 6. Start chat conversation                                                                                                                                                                                                                   
 7. Ask LLM to "list memories" (should show summaries only)                                                                                                                                                                                   
 8. Ask LLM to "get memory with title Test Skill" (should show full content)                                                                                                                                                                  
 9. Verify system message includes only memories with includeInSystemMessage=true                                                                                                                                                             
                                                                                                                                                                                                                                              
 Critical Files to Modify                                                                                                                                                                                                                     
                                                                                                                                                                                                                                              
 1. /backend/src/services/memoryMigration.js - NEW FILE: Migration logic                                                                                                                                                                      
 2. /backend/src/services/memoryManager.js - Core memory management, filtering, migration trigger                                                                                                                                             
 3. /backend/src/index.js - MCP tool definitions and handlers                                                                                                                                                                                 
 4. /backend/src/routes/chat.js - API endpoints for CRUD operations                                                                                                                                                                           
 5. /frontend/src/components/MemoriesTab.jsx - React component for memory UI                                                                                                                                                                  
 6. /frontend/src/components/MemoriesTab.css - Styling for new fields                                                                                                                                                                         
 7. /frontend/src/services/api.js - Frontend API client methods                                                                                                                                                                               
                                                                                                                                                                                                                                              
 Migration Strategy                                                                                                                                                                                                                           
                                                                                                                                                                                                                                              
 Automatic Migration on Startup                                                                                                                                                                                                               
                                                                                                                                                                                                                                              
 - Detection: check if any memory has category field or missing title/type fields                                                                                                                                                             
 - Process:                                                                                                                                                                                                                                   
   - Generate title from first sentence or first 50 chars                                                                                                                                                                                     
   - Generate description from first 150 chars                                                                                                                                                                                                
   - Map category → type (1:1 mapping + add "skill")                                                                                                                                                                                          
   - Set includeInSystemMessage=true (maintain current behavior)                                                                                                                                                                              
   - Remove old category field                                                                                                                                                                                                                
 - Save: write migrated data back to memories.json                                                                                                                                                                                            
 - Log: migration details for each memory                                                                                                                                                                                                     
                                                                                                                                                                                                                                              
 Rollback Plan                                                                                                                                                                                                                                
                                                                                                                                                                                                                                              
 - Backup file created at: /home/workspace/zo_chat_memories/memories.json.backup.pre-v2                                                                                                                                                       
 - Rollback: restore backup, revert code changes                                                                                                                                                                                              
 - Recovery: reverse migration script available if needed                                                                                                                                                                                     
                                                                                                                                                                                                                                              
 Risk Mitigation                                                                                                                                                                                                                              
 ┌────────────────────────────┬───────────────────────────────────────────────────────────────────────┐                                                                                                                                       
 │            Risk            │                              Mitigation                               │                                                                                                                                       
 ├────────────────────────────┼───────────────────────────────────────────────────────────────────────┤                                                                                                                                       
 │ Data loss during migration │ Automatic backup before migration, extensive testing                  │                                                                                                                                       
 ├────────────────────────────┼───────────────────────────────────────────────────────────────────────┤                                                                                                                                       
 │ Breaking LLM behavior      │ Maintain content field structure, default includeInSystemMessage=true │                                                                                                                                       
 ├────────────────────────────┼───────────────────────────────────────────────────────────────────────┤                                                                                                                                       
 │ Duplicate title handling   │ get_memory returns error listing all matching IDs                     │                                                                                                                                       
 ├────────────────────────────┼───────────────────────────────────────────────────────────────────────┤                                                                                                                                       
 │ UI confusion               │ Clear labels, help text, intuitive toggle placement                   │                                                                                                                                       
 └────────────────────────────┴───────────────────────────────────────────────────────────────────────┘                                                                                                                                       
 Success Criteria                                                                                                                                                                                                                             
                                                                                                                                                                                                                                              
 - ✅ All existing memories migrated with no data loss                                                                                                                                                                                        
 - ✅ New memories can be created with title/description/type/includeInSystemMessage                                                                                                                                                          
 - ✅ System message only includes memories where includeInSystemMessage=true                                                                                                                                                                 
 - ✅ list_memories returns summaries only (no content)                                                                                                                                                                                       
 - ✅ get_memory retrieves full memory by ID or title                                                                                                                                                                                         
 - ✅ Frontend UI displays all new fields with toggle control                                                                                                                                                                                 
 - ✅ "Skill" type available and functional                                                                                                                                                                                                   
                                                                                                                                                                                                                                              
 Future Enhancements                                                                                                                                                                                                                          
                                                                                                                                                                                                                                              
 - Full-text search across title/description/content                                                                                                                                                                                          
 - Bulk operations (edit, delete by type)                                                                                                                                                                                                     
 - Memory tags/labels and relationships                                                                                                                                                                                                       
 - SQLite migration when memory count grows large